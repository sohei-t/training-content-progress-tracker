#!/usr/bin/env python3
"""
Portfolioç”¨ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«æ–‡æ›¸ç”Ÿæˆ
æŠ€è¡“ã‚¢ãƒ”ãƒ¼ãƒ«ç”¨ã«ClientåŒç­‰ã®æ­£å¼æ–‡æ›¸ã‚’ç”Ÿæˆ
"""

import os
import sys
import subprocess
from pathlib import Path
from datetime import datetime

# enhanced_client_document_generatorã‚’æµç”¨
from enhanced_client_document_generator import ClientDocumentGenerator

class PortfolioDocumentGenerator(ClientDocumentGenerator):
    """Portfolioç”¨ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸæ–‡æ›¸ç”Ÿæˆå™¨"""

    def __init__(self, project_path="."):
        super().__init__(project_path)
        self.output_dir = Path(project_path) / "professional-docs"

    def generate_portfolio_documents(self):
        """Portfolioç”¨ã®æ–‡æ›¸ã‚»ãƒƒãƒˆã‚’ç”Ÿæˆ"""
        print("ğŸ“„ Portfolioç”¨ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«æ–‡æ›¸ã‚’ç”Ÿæˆä¸­...")

        # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
        self.output_dir.mkdir(parents=True, exist_ok=True)

        # å„æ–‡æ›¸ã‚’ç”Ÿæˆï¼ˆMarkdownå½¢å¼ï¼‰
        documents = {
            "requirements-spec.md": self.generate_requirements_doc(),
            "design-spec.md": self.generate_basic_design(),
            "test-report.md": self.generate_test_report(),
            "user-manual.md": self.generate_user_manual()
        }

        # Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
        for filename, content in documents.items():
            filepath = self.output_dir / filename
            with open(filepath, 'w', encoding='utf-8') as f:
                # Portfolioç”¨ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
                header = f"""---
title: {filename.replace('.md', '').replace('-', ' ').title()}
project: {self.project_info.get('project', {}).get('name', 'Project')}
generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
ai_generated: true
---

# ğŸ“‹ AIè‡ªå‹•ç”Ÿæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚
> å®Ÿéš›ã®é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨åŒç­‰ã®å“è³ªã®æ–‡æ›¸ã‚’ã€ã‚ãšã‹æ•°ç§’ã§ç”Ÿæˆã§ãã‚‹ã“ã¨ã‚’å®Ÿè¨¼ã—ã¦ã„ã¾ã™ã€‚

---

"""
                f.write(header + content)
            print(f"  âœ… {filename}")

        # PDFå¤‰æ›ã‚’è©¦ã¿ã‚‹
        self.convert_to_pdf_if_possible()

        # READMEã‚’ç”Ÿæˆ
        self.generate_docs_readme()

        return self.output_dir

    def convert_to_pdf_if_possible(self):
        """å¯èƒ½ã§ã‚ã‚Œã°PDFã«å¤‰æ›"""
        # pdf_converter.jsãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
        pdf_converter = Path(__file__).parent / "pdf_converter.js"

        if pdf_converter.exists() and (self.project_path / "node_modules" / "puppeteer").exists():
            print("  ğŸ“„ PDFã«å¤‰æ›ä¸­...")
            try:
                subprocess.run(
                    ["node", str(pdf_converter), str(self.output_dir)],
                    capture_output=True,
                    text=True,
                    timeout=30
                )
                print("  âœ… PDFå¤‰æ›å®Œäº†")
            except Exception as e:
                print(f"  âš ï¸ PDFå¤‰æ›ã‚¹ã‚­ãƒƒãƒ—: {e}")
        else:
            print("  â„¹ï¸ PDFå¤‰æ›ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ï¼ˆMarkdownå½¢å¼ã§ä¿å­˜ï¼‰")

    def generate_docs_readme(self):
        """professional-docsç”¨ã®READMEç”Ÿæˆ"""
        readme_content = f"""# ğŸ“š ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€**å®Ÿéš›ã®æ¥­å‹™ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«ã®æ­£å¼æ–‡æ›¸**ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚
ã™ã¹ã¦ã®æ–‡æ›¸ã¯**AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚Šè‡ªå‹•ç”Ÿæˆ**ã•ã‚Œã¾ã—ãŸã€‚

## å«ã¾ã‚Œã‚‹æ–‡æ›¸

### ğŸ“‹ è¦ä»¶å®šç¾©æ›¸ (requirements-spec)
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- æ©Ÿèƒ½è¦ä»¶ãƒ»éæ©Ÿèƒ½è¦ä»¶
- åˆ¶ç´„äº‹é …
- æˆæœç‰©å®šç¾©

### ğŸ“ åŸºæœ¬è¨­è¨ˆæ›¸ (design-spec)
- ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
- ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
- APIä»•æ§˜

### ğŸ§ª ãƒ†ã‚¹ãƒˆçµæœå ±å‘Šæ›¸ (test-report)
- ãƒ†ã‚¹ãƒˆå®Ÿæ–½çµæœ
- ã‚«ãƒãƒ¬ãƒƒã‚¸åˆ†æ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š
- å“è³ªè©•ä¾¡

### ğŸ“– æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ« (user-manual)
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †
- ä½¿ç”¨æ–¹æ³•
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- FAQ

## ç‰¹å¾´

- âœ… **å®Œå…¨è‡ªå‹•ç”Ÿæˆ**: ã‚³ãƒ¼ãƒ‰ã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’æŠ½å‡ºã—ã€è‡ªå‹•ã§æ–‡æ›¸åŒ–
- âœ… **ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å“è³ª**: å®Ÿéš›ã®æ¥­å‹™ã§ä½¿ç”¨å¯èƒ½ãªãƒ¬ãƒ™ãƒ«
- âœ… **PDFå¯¾å¿œ**: å°åˆ·ãƒ»é…å¸ƒå¯èƒ½ãªå½¢å¼
- âœ… **æ—¥æœ¬èªå¯¾å¿œ**: ãƒ“ã‚¸ãƒã‚¹æ–‡æ›¸ã¨ã—ã¦é©åˆ‡ãªæ—¥æœ¬èªè¡¨ç¾

## ç”Ÿæˆæ™‚é–“

ã“ã‚Œã‚‰ã™ã¹ã¦ã®æ–‡æ›¸ã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚Š**ç´„1åˆ†**ã§ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚

## æŠ€è¡“çš„æ„ç¾©

ã“ã®ã‚ˆã†ãªåŒ…æ‹¬çš„ãªæ–‡æ›¸ã‚»ãƒƒãƒˆã‚’è‡ªå‹•ç”Ÿæˆã§ãã‚‹ã“ã¨ã¯ã€
**é–‹ç™ºåŠ¹ç‡ã®å¤§å¹…ãªå‘ä¸Š**ã¨**å“è³ªã®æ¨™æº–åŒ–**ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

Generated by AI Agent System @ {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""

        readme_path = self.output_dir / "README.md"
        with open(readme_path, 'w', encoding='utf-8') as f:
            f.write(readme_content)
        print("  âœ… README.md ç”Ÿæˆå®Œäº†")

def main():
    """Portfolioæ–‡æ›¸ç”Ÿæˆã®ãƒ¡ã‚¤ãƒ³å‡¦ç†"""
    generator = PortfolioDocumentGenerator()
    output_dir = generator.generate_portfolio_documents()

    print(f"\nâœ… Portfolioç”¨æ–‡æ›¸ç”Ÿæˆå®Œäº†ï¼")
    print(f"ğŸ“ å ´æ‰€: {output_dir}")
    print("\nã“ã‚Œã‚‰ã®æ–‡æ›¸ã¯ã€ã‚ãªãŸã®ä»¥ä¸‹ã®èƒ½åŠ›ã‚’è¨¼æ˜ã—ã¾ã™ï¼š")
    print("  - AIã‚’æ´»ç”¨ã—ãŸè‡ªå‹•åŒ–èƒ½åŠ›")
    print("  - ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªæ–‡æ›¸ä½œæˆèƒ½åŠ›")
    print("  - åŠ¹ç‡çš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†èƒ½åŠ›")

if __name__ == "__main__":
    main()